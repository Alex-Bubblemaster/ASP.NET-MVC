@model SpecTester.Web.ViewModels.Home.TrainingViewModel
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<br />
<div class="row" id="menu">
    <div class="col-md-8">
        <div class="well">
            <div class="caption text-center training-title">
                <h3>@Model.Name</h3>
                <h4>Score: @Model.Score</h4>
                <h4>Participants: @Model.Users</h4>
            </div>
            <div>
                <div id="placeholder">
                    <img class="img-responsive img-rounded" id="plate" src="~/Content/images/site/plate.png" alt="plate" />
                </div>

            </div>
        </div>
    </div>
    
    <div class="col-md-4" id="dish-menu">
        @foreach (var dish in Model.Dishes)
            {
            <div class="well dish">
                <a href="#" class="dish">
                    <h4 id="@dish.Id" class="caption text-center training-title">@dish.Name</h4>
                </a>
            </div>
        }
        <div id="show-products"></div>
        <a href="#" id="cancel" class="btn btn-lg btn-warning">Cancel</a>
    </div>
</div>

@section scripts{
    <script>
        var currentRecipe;
        var dishes = $("#dish-menu");
        $(document).ready(function () {
            $('#cancel').hide();
        });

        $(".dish").on("click", function (ev) {
            var id = ev.target.id;
            currentRecipe = $("#" + id);
            $(".dish").hide();
            $('#cancel').show();
            dishes.prepend(currentRecipe);
            currentRecipe.show();
            $('#show-products').load("/SpecTraining/GetProducts");
        });

        $("#cancel").on("click", function () {
            $(".dish").show();
            $('#cancel').hide();
            $("#show-products").hide();
        });

        function drag_start(event) {
            var style = window.getComputedStyle(event.target, null);
            event.dataTransfer.setData("text/plain",
            (parseInt(style.getPropertyValue("left"), 10) - event.clientX) + ',' + (parseInt(style.getPropertyValue("top"), 10) - event.clientY));
        }

        function drag_over(event) {
            event.preventDefault();
            return false;
        }

        function drop(event) {
            var offset = event.dataTransfer.getData("text/plain").split(',');
            console.log(event.target);
            var dm = document.getElementById('product');
            dm.style.left = (event.clientX + parseInt(offset[0], 10)) + 'px';
            dm.style.top = (event.clientY + parseInt(offset[1], 10)) + 'px';
            event.preventDefault();
            return false;
        }
        var products = $('aside');
        for (var i = 0; i < products.length; i++) {
            products[i].addEventListener('dragstart', drag_start, false);
        }
        document.body.addEventListener('dragover', drag_over, false);
        document.body.addEventListener('drop', drop, false);
    </script>
}

